<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Karbohydratkalkulator og Insulinberegner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython_stdlib.js"></script>
    <style>
        body {
            font-family: sans-serif;
            font-size: 18px;
            margin: 0;
            padding: 20px;
            background-image: url('https://images.unsplash.com/photo-1490645935967-10de6ba17061?q=80&w=2053&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        input, button, select {
            font-size: 18px;
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .resultat {
            font-weight: bold;
            color: #2c3e50;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #ddd;
        }

        .hoved-resultat {
            font-weight: bold;
            color: #fff;
            background-color: #27ae60;
            padding: 15px;
            border-radius: 5px;
            font-size: 1.2em;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .advarsel {
            background-color: #fff3cd; 
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #ffeeba;
            font-size: 0.9em;
            line-height: 1.5;
        }

        hr {
            margin: 30px 0;
            border: 0;
            border-top: 1px solid #ddd;
        }
        
        .meny-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .meny-knapp {
            width: 49%;
            background-color: #e0e0e0;
            border: none;
            cursor: pointer;
            padding: 10px;
            font-weight: bold;
            color: #555;
            transition: background-color 0.3s;
        }
        .meny-knapp.aktiv {
            background-color: #3498db;
            color: white;
        }

        .lang-link {
            float: right;
            text-decoration: none;
            font-size: 0.9em;
            color: #555;
            background: #eee;
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .lang-link:hover {
            background-color: #ddd;
        }

        /* Stil for valg av utstyr */
        .utstyr-valg {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
            justify-content: center;
        }
        .utstyr-valg label {
            cursor: pointer;
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #555;
        }
        .utstyr-valg input {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }
    </style>
</head>
<body onload="brython()">
    
    <div class="container">

        <a href="english.html" class="lang-link">游섫릖 English version</a>
        <div style="clear: both;"></div>

        <h2 style="margin-top: 0;">1. Hvor mye karbohydrater?</h2>
        
        <div class="meny-container">
            <button id="btn_velg_kalkulator" class="meny-knapp aktiv">Bruk Kalkulator</button>
            <button id="btn_velg_direkte" class="meny-knapp">Jeg vet antallet</button>
        </div>

        <div id="kalkulator_boks">
            <label>Karbohydrater per 100g:</label>
            <input type="number" id="karbohydrater" placeholder="F.eks 65">
            
            <label>Vekt (i gram):</label>
            <input type="number" id="vekt" placeholder="F.eks 80">
            
            <button id="beregn" style="background-color: #ecf0f1; border: 1px solid #ccc;">Beregn Karbohydrater</button>
        </div>

        <div id="direkte_boks" style="display: none;">
            <label>Total mengde karbohydrater i m친ltidet:</label>
            <input type="number" id="direkte_karbo_input" placeholder="F.eks 45">
            <button id="bruk_direkte" style="background-color: #ecf0f1; border: 1px solid #ccc;">Bruk dette antallet</button>
        </div>

        <p id="karbohydrat_resultat" class="resultat">Ingen karbohydrater registrert enda.</p>

        <hr>

        <h2>2. Din Insulin-faktor</h2>
        <p><i>(Hvor mange gram karbohydrater 1 enhet insulin dekker)</i></p>

        <div class="meny-container">
            <button id="btn_velg_500regel" class="meny-knapp aktiv">Bruk 500-regelen</button>
            <button id="btn_velg_manuell_faktor" class="meny-knapp">Jeg vet faktoren</button>
        </div>
        
        <div id="faktor_kalkulator_boks">
            <label>Total d칮gndose insulin (E):</label>
            <input type="number" id="insulin" placeholder="F.eks 55">
            <button id="beregn_insulin" style="background-color: #ecf0f1; border: 1px solid #ccc;">Beregn Insulin-faktor</button>
        </div>

        <div id="faktor_manuell_boks" style="display: none;">
            <label>Din insulin-faktor (gram karbo per enhet):</label>
            <input type="number" id="manuell_faktor_input" placeholder="F.eks 2.48 eller 10">
            <button id="bruk_manuell_faktor" style="background-color: #ecf0f1; border: 1px solid #ccc;">Bruk denne faktoren</button>
        </div>

        <p id="insulin_resultat" class="resultat">Ingen faktor valgt enda.</p>

        <hr>

        <h2>3. Din anbefalte dose</h2>
        
        <div class="utstyr-valg">
            <label>
                <input type="radio" name="utstyr" id="valg_penn" value="penn" checked> 
                Insulinpenn
            </label>
            <label>
                <input type="radio" name="utstyr" id="valg_pumpe" value="pumpe"> 
                Insulinpumpe
            </label>
        </div>

        <p id="total_dose_resultat" class="hoved-resultat">Fyll ut steg 1 og 2 for 친 se dosen automatisk</p>

        <div class="advarsel">
            <strong>Viktig:</strong> Denne kalkulatoren er kun ment som et veiledende hjelpemiddel. 
            Du kjenner din diabetes best. Hvis den foresl친tte dosen ikke stemmer overens med din egen erfaring eller vurdering, skal du alltid stole p친 din egen d칮mmekraft.
        </div>

        <br><br>
        <button id="nullstill" style="background-color: #e74c3c; color: white;">Nullstill alt (Sletter ogs친 lagret data)</button>

    </div>

    <script type="text/python">
from browser import document, bind
from browser.local_storage import storage

# Globale variabler
karbo_i_maltid = 0
min_faktor = 0

# --- VISNINGSFUNKSJONER (TABS) ---
def vis_kalkulator(ev):
    document['kalkulator_boks'].style.display = 'block'
    document['direkte_boks'].style.display = 'none'
    document['btn_velg_kalkulator'].classList.add('aktiv')
    document['btn_velg_direkte'].classList.remove('aktiv')

def vis_direkte(ev):
    document['kalkulator_boks'].style.display = 'none'
    document['direkte_boks'].style.display = 'block'
    document['btn_velg_kalkulator'].classList.remove('aktiv')
    document['btn_velg_direkte'].classList.add('aktiv')

def vis_500regel(ev):
    document['faktor_kalkulator_boks'].style.display = 'block'
    document['faktor_manuell_boks'].style.display = 'none'
    document['btn_velg_500regel'].classList.add('aktiv')
    document['btn_velg_manuell_faktor'].classList.remove('aktiv')

def vis_manuell_faktor(ev):
    document['faktor_kalkulator_boks'].style.display = 'none'
    document['faktor_manuell_boks'].style.display = 'block'
    document['btn_velg_500regel'].classList.remove('aktiv')
    document['btn_velg_manuell_faktor'].classList.add('aktiv')

# --- BEREGNINGSFUNKSJONER ---

# Steg 1
def beregn_kalkulator(ev):
    global karbo_i_maltid
    try:
        karbohydrater = float(document['karbohydrater'].value)
        vekt = float(document['vekt'].value)
        karbo_i_maltid = int((karbohydrater / 100) * vekt) 
        document['karbohydrat_resultat'].text = f"Beregnet: {karbo_i_maltid} gram karbohydrater."
        oppdater_total()
    except ValueError:
        document['karbohydrat_resultat'].text = "Skriv inn gyldige tall i kalkulatoren."

def bruk_direkte(ev):
    global karbo_i_maltid
    try:
        input_verdi = float(document['direkte_karbo_input'].value)
        karbo_i_maltid = int(input_verdi)
        document['karbohydrat_resultat'].text = f"Satt manuelt: {karbo_i_maltid} gram karbohydrater."
        oppdater_total()
    except ValueError:
        document['karbohydrat_resultat'].text = "Skriv inn et gyldig tall."

# Steg 2
def beregn_insulin(ev):
    global min_faktor
    try:
        total_insulin = float(document['insulin'].value)
        if total_insulin == 0:
            document['insulin_resultat'].text = "D칮gndosen kan ikke v칝re 0."
            return
        
        storage['lagret_dose_no'] = str(total_insulin) 
        if 'lagret_faktor_no' in storage: del storage['lagret_faktor_no']

        min_faktor = round(500 / total_insulin, 1)
        
        document['insulin_resultat'].text = f"Din faktor (500-regelen): 1 enhet dekker {min_faktor} gram karbo."
        oppdater_total()
    except ValueError:
        document['insulin_resultat'].text = "Skriv inn gyldig d칮gndose."

def bruk_manuell_faktor(ev):
    global min_faktor
    try:
        input_faktor = float(document['manuell_faktor_input'].value)
        if input_faktor == 0:
            document['insulin_resultat'].text = "Faktoren kan ikke v칝re 0."
            return

        storage['lagret_faktor_no'] = str(input_faktor) 
        if 'lagret_dose_no' in storage: del storage['lagret_dose_no']

        min_faktor = input_faktor
        document['insulin_resultat'].text = f"Din faktor (Manuelt): 1 enhet dekker {min_faktor} gram karbo."
        oppdater_total()
    except ValueError:
        document['insulin_resultat'].text = "Skriv inn et gyldig tall for faktor."

# Steg 3 - OPPDATERT FOR PUMPE
def oppdater_total(ev=None):
    global karbo_i_maltid, min_faktor
    
    if karbo_i_maltid > 0 and min_faktor > 0:
        # Sjekker hvilket valg som er markert
        er_penn = document['valg_penn'].checked
        
        dose_raw = karbo_i_maltid / min_faktor
        
        if er_penn:
            # Runder til n칝rmeste heltall for penn
            dose = int(round(dose_raw + 0,5)
            document['total_dose_resultat'].text = f"Anbefalt dose: {dose} enheter"
        else:
            # Pumpe: Viser gram (som input) og beregnet dose (som sjekk)
            dose = round(dose_raw, 2)
            document['total_dose_resultat'].text = f"Legg inn {karbo_i_maltid}g karbo p친 pumpen (Gir ca {dose} E)"
    else:
        document['total_dose_resultat'].text = "Mangler tall fra steg 1 eller 2..."

def nullstill(ev):
    global karbo_i_maltid, min_faktor
    karbo_i_maltid = 0
    min_faktor = 0
    
    if 'lagret_dose_no' in storage: del storage['lagret_dose_no']
    if 'lagret_faktor_no' in storage: del storage['lagret_faktor_no']

    document['karbohydrater'].value = ""
    document['vekt'].value = ""
    document['direkte_karbo_input'].value = ""
    document['insulin'].value = ""
    document['manuell_faktor_input'].value = ""
    
    document['karbohydrat_resultat'].text = "Ingen karbohydrater registrert enda."
    document['insulin_resultat'].text = "Ingen faktor valgt enda."
    document['total_dose_resultat'].text = "Fyll ut steg 1 og 2 for 친 se dosen automatisk"

# --- OPPSTART ---
if 'lagret_dose_no' in storage:
    document['insulin'].value = storage['lagret_dose_no']
    vis_500regel(None)
    beregn_insulin(None)
elif 'lagret_faktor_no' in storage:
    document['manuell_faktor_input'].value = storage['lagret_faktor_no']
    vis_manuell_faktor(None)
    bruk_manuell_faktor(None)

# Koblinger
document['btn_velg_kalkulator'].bind('click', vis_kalkulator)
document['btn_velg_direkte'].bind('click', vis_direkte)

document['btn_velg_500regel'].bind('click', vis_500regel)
document['btn_velg_manuell_faktor'].bind('click', vis_manuell_faktor)

document['beregn'].bind('click', beregn_kalkulator)
document['bruk_direkte'].bind('click', bruk_direkte)
document['beregn_insulin'].bind('click', beregn_insulin)
document['bruk_manuell_faktor'].bind('click', bruk_manuell_faktor)
document['nullstill'].bind('click', nullstill)

document['valg_penn'].bind('change', oppdater_total)
document['valg_pumpe'].bind('change', oppdater_total)
    </script>
</body>
</html>
