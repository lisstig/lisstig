<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Karbohydratkalkulator og Insulinberegner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython_stdlib.js"></script>
    <style>
        body {
            font-family: sans-serif;
            font-size: 18px;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background-color: #fafafa;
        }
        input, button {
            font-size: 18px;
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
        }
        .resultat {
            font-weight: bold;
            color: #2c3e50;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .hoved-resultat {
            font-weight: bold;
            color: #fff;
            background-color: #27ae60;
            padding: 15px;
            border-radius: 5px;
            font-size: 1.2em;
            margin-top: 20px;
            text-align: center;
        }
        
        .advarsel {
            background-color: #fff3cd; 
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border: 1px solid #ffeeba;
            font-size: 0.9em;
            line-height: 1.5;
        }

        hr {
            margin: 30px 0;
            border: 1px solid #ddd;
        }
        
        .meny-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .meny-knapp {
            width: 49%;
            background-color: #ddd;
            border: none;
            cursor: pointer;
            padding: 10px;
            font-weight: bold;
            color: #555;
        }
        .meny-knapp.aktiv {
            background-color: #3498db;
            color: white;
        }

        .lang-link {
            float: right;
            text-decoration: none;
            font-size: 0.9em;
            color: #555;
            background: #eee;
            padding: 5px 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body onload="brython()">
    
    <a href="english.html" class="lang-link">游섫릖 English version</a>
    <div style="clear: both;"></div>

    <h2>1. Hvor mye karbohydrater?</h2>
    
    <div class="meny-container">
        <button id="btn_velg_kalkulator" class="meny-knapp aktiv">Bruk Kalkulator</button>
        <button id="btn_velg_direkte" class="meny-knapp">Jeg vet antallet</button>
    </div>

    <div id="kalkulator_boks">
        <label>Karbohydrater per 100g:</label>
        <input type="number" id="karbohydrater" placeholder="F.eks 65">
        
        <label>Vekt (i gram):</label>
        <input type="number" id="vekt" placeholder="F.eks 80">
        
        <button id="beregn" style="background-color: #ecf0f1; border: 1px solid #ccc;">Beregn Karbohydrater</button>
    </div>

    <div id="direkte_boks" style="display: none;">
        <label>Total mengde karbohydrater i m친ltidet:</label>
        <input type="number" id="direkte_karbo_input" placeholder="F.eks 45">
        <button id="bruk_direkte" style="background-color: #ecf0f1; border: 1px solid #ccc;">Bruk dette antallet</button>
    </div>

    <p id="karbohydrat_resultat" class="resultat">Ingen karbohydrater registrert enda.</p>

    <hr>

    <h2>2. Beregn din Insulin-faktor</h2>
    <p><i>(Hvor mange gram karbohydrater 1 enhet insulin dekker)</i></p>
    
    <label>Total d칮gndose insulin (E):</label>
    <input type="number" id="insulin" placeholder="F.eks 55">
    
    <button id="beregn_insulin" style="background-color: #ecf0f1; border: 1px solid #ccc;">Beregn Insulin-faktor</button>
    <p id="insulin_resultat" class="resultat">Resultat vises her...</p>

    <hr>

    <h2>3. Din anbefalte dose</h2>
    
    <p id="total_dose_resultat" class="hoved-resultat">Fyll ut steg 1 og 2 for 친 se dosen automatisk</p>

    <div class="advarsel">
        <strong>Viktig:</strong> Denne kalkulatoren er kun ment som et veiledende hjelpemiddel. 
        Du kjenner din diabetes best. Hvis den foresl친tte dosen ikke stemmer overens med din egen erfaring eller vurdering, skal du alltid stole p친 din egen d칮mmekraft.
    </div>

    <br><br>
    <button id="nullstill" style="background-color: #e74c3c; color: white;">Nullstill alt (Sletter ogs친 lagret dose)</button>

    <script type="text/python">
from browser import document
from browser.local_storage import storage  # Vi importerer lagring

# Globale variabler
karbo_i_maltid = 0
min_faktor = 0

def vis_kalkulator(ev):
    document['kalkulator_boks'].style.display = 'block'
    document['direkte_boks'].style.display = 'none'
    document['btn_velg_kalkulator'].classList.add('aktiv')
    document['btn_velg_direkte'].classList.remove('aktiv')

def vis_direkte(ev):
    document['kalkulator_boks'].style.display = 'none'
    document['direkte_boks'].style.display = 'block'
    document['btn_velg_kalkulator'].classList.remove('aktiv')
    document['btn_velg_direkte'].classList.add('aktiv')

def beregn_kalkulator(ev):
    global karbo_i_maltid
    try:
        karbohydrater = float(document['karbohydrater'].value)
        vekt = float(document['vekt'].value)
        karbo_i_maltid = int((karbohydrater / 100) * vekt) 
        
        document['karbohydrat_resultat'].text = f"Beregnet: {karbo_i_maltid} gram karbohydrater."
        oppdater_total()
    except ValueError:
        document['karbohydrat_resultat'].text = "Skriv inn gyldige tall i kalkulatoren."

def bruk_direkte(ev):
    global karbo_i_maltid
    try:
        input_verdi = float(document['direkte_karbo_input'].value)
        karbo_i_maltid = int(input_verdi)
        
        document['karbohydrat_resultat'].text = f"Satt manuelt: {karbo_i_maltid} gram karbohydrater."
        oppdater_total()
    except ValueError:
        document['karbohydrat_resultat'].text = "Skriv inn et gyldig tall."

def beregn_insulin(ev):
    global min_faktor
    try:
        total_insulin = float(document['insulin'].value)
        if total_insulin == 0:
            document['insulin_resultat'].text = "D칮gndosen kan ikke v칝re 0."
            return
        
        # LAGRING: Her lagrer vi dosen i nettleseren
        storage['lagret_dose_no'] = str(total_insulin)

        min_faktor = int(500 / total_insulin)
        document['insulin_resultat'].text = f"Din faktor: 1 enhet dekker {min_faktor} gram karbohydrater."
        oppdater_total()
    except ValueError:
        document['insulin_resultat'].text = "Skriv inn gyldig d칮gndose."

def oppdater_total():
    global karbo_i_maltid, min_faktor
    
    if karbo_i_maltid > 0 and min_faktor > 0:
        dose = int(round(karbo_i_maltid / min_faktor))
        document['total_dose_resultat'].text = f"Anbefalt dose: {dose} enheter insulin"
    else:
        document['total_dose_resultat'].text = "Mangler tall fra steg 1 eller 2..."

def nullstill(ev):
    global karbo_i_maltid, min_faktor
    karbo_i_maltid = 0
    min_faktor = 0
    
    # SLETTER LAGRING: Slik at man kan starte p친 nytt
    if 'lagret_dose_no' in storage:
        del storage['lagret_dose_no']

    document['karbohydrater'].value = ""
    document['vekt'].value = ""
    document['direkte_karbo_input'].value = ""
    document['insulin'].value = ""
    
    document['karbohydrat_resultat'].text = "Ingen karbohydrater registrert enda."
    document['insulin_resultat'].text = "Resultat vises her..."
    document['total_dose_resultat'].text = "Fyll ut steg 1 og 2 for 친 se dosen automatisk"

# --- OPPSTART ---
# Sjekker om vi har lagret noe fra f칮r
if 'lagret_dose_no' in storage:
    document['insulin'].value = storage['lagret_dose_no']
    # Kj칮rer beregningen automatisk slik at faktoren vises med en gang
    beregn_insulin(None)

# Koblinger
document['btn_velg_kalkulator'].bind('click', vis_kalkulator)
document['btn_velg_direkte'].bind('click', vis_direkte)

document['beregn'].bind('click', beregn_kalkulator)
document['bruk_direkte'].bind('click', bruk_direkte)
document['beregn_insulin'].bind('click', beregn_insulin)
document['nullstill'].bind('click', nullstill)
    </script>
</body>
</html>
